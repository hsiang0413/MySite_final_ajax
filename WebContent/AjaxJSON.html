<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Insert title here</title>
<link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>
	<div class="container">
		<nav class="navbar navbar-default">
			<div class="container-fluid">
				<!-- Brand and toggle get grouped for better mobile display -->
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed"
						data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
						aria-expanded="false">
						<span class="sr-only">Toggle navigation</span> <span
							class="icon-bar"></span> <span class="icon-bar"></span> <span
							class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">Ajax Site</a>
				</div>

				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse"
					id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav">
						<li class="dropdown"><a href="#" class="dropdown-toggle"
							data-toggle="dropdown" role="button" aria-haspopup="true"
							aria-expanded="false">XMLHttpRequest<span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li><a href="AjaxFirst.html">同步</a></li>
								<li><a href="AjaxAsync.html">非同步</a></li>
								<li><a href="AjaxGet.html">Get</a></li>
								<li><a href="AjaxPost.html">Post</a></li>
								<li><a href="AjaxForOldIE.html">OldIE</a></li>
							</ul></li>
						<li><a href="AjaxXML.html">XML</a></li>
						<li class="dropdown"><a href="#" class="dropdown-toggle"
							data-toggle="dropdown" role="button" aria-haspopup="true"
							aria-expanded="false">JSON<span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li><a href="JSON.html">JSON</a></li>
								<li><a href="AjaxJSON.html">AjaxJSON</a></li>
								<li><a href="JSONP.html">JSONP</a></li>
							</ul></li>
						<li class="dropdown"><a href="#" class="dropdown-toggle"
							data-toggle="dropdown" role="button" aria-haspopup="true"
							aria-expanded="false">Ajax New<span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li><a href="Ajax2Event.html">Ajax2Event</a></li>
								<li><a href="FormData.html">FormData</a></li>
								<li><a href="Ajax2Cors.html">Cors</a></li>
							</ul></li>
						<li class="dropdown"><a href="#" class="dropdown-toggle"
							data-toggle="dropdown" role="button" aria-haspopup="true"
							aria-expanded="false">作業<span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li><a href="Register.html">帳號檢查</a></li>
								<li><a href="RssReader.html">RSS閱讀器</a></li>
								<li><a href="AutoComplete.html">自動完成</a></li>
							</ul></li>
					
					</ul>


				</div>
				<!-- /.navbar-collapse -->
			</div>
			<!-- /.container-fluid -->
		</nav>
	</div>
	<div class="container">
		<div class="jumbotron">
			<div class="page-header">
				<h3>
					JSON <small>Ajax JSON</small>
				</h3>
			</div>
			<!-- 每頁不同的內容從這裡開始 -->
			<select id="select1">
			   <option value="0">請選擇</option>
			</select>
			<div id="div1">
			 <table class="table table-bordered table-hover">
		          <thead>
		              <tr>
		                 <th>ProductID</th>
		                 <th>ProductName</th>
		                 <th>UnitPrice</th>
		                 <th>UnitsInStock</th>
		              </tr>
		          </thead>
		          <tbody>
		              <tr>
		                <td>1</td>
		                <td>Chai</td>
		                <td>18.0000</td>
		                <td>39</td>
		              </tr>
		              <tr>
		                <td>2</td>
		                <td>Chang</td>
		                <td>19.0000</td>
		                <td>17</td>
		              </tr>
		          </tbody>
		        </table>
			</div>


			<!-- 每頁不同的內容到這裡結束 -->
		</div>

		<div class="row">
			<div class="col-md-4">
				<h2>HTML5</h2>
				<p>HTML5是HTML最新的修訂版本，2014年10月由全球資訊網協會（W3C）完成標準制定。[2][3][4]目標是取代1999年所製定的HTML
					4.01和XHTML 1.0標準，以期能在網際網路應用迅速發展的時候，使網路標準達到符合當代的網路需求。</p>
				<p>
					<a class="btn btn-primary"
						href="https://zh.wikipedia.org/wiki/HTML5" role="button">詳細資料
						&raquo;</a>
				</p>
			</div>
			<div class="col-md-4">
				<h2>CSS3</h2>
				<p>階層式樣式表，一種用來為結構化文件（如HTML文件或XML應用）添加樣式（字型、間距和顏色等）的電腦語言，由W3C定義和維護。目前最新版本是CSS2.1，為W3C的推薦標準。CSS3現在已被大部分現代瀏覽器支援，而下一版的CSS4仍在開發過程中。</p>
				<p>
					<a class="btn btn-primary"
						href="https://zh.wikipedia.org/wiki/%E5%B1%82%E5%8F%A0%E6%A0%B7%E5%BC%8F%E8%A1%A8#CSS3"
						role="button">詳細資料 &raquo;</a>
				</p>
			</div>
			<div class="col-md-4">
				<h2>JavaScript</h2>
				<p>JavaScript，直譯式程式語言，是一種動態型別、基於原型的語言，內建支援類別。它的直譯器被稱為JavaScript引擎，為瀏覽器的一部分，廣泛用於用戶端的腳本語言，最早是在HTML網頁上使用，用來給HTML網頁增加動態功能。現在JavaScript也可被用於網路伺服器，如Node.js。</p>
				<p>
					<a class="btn btn-primary"
						href="https://zh.wikipedia.org/wiki/JavaScript" role="button">詳細資料
						&raquo;</a>
				</p>
			</div>
		</div>

		<!-- Site footer -->
		<footer class="footer">
			<p>&copy; IIIEDU</p>
		</footer>

	</div>
	<!-- /container -->


	<script src="js/jquery-1.9.1.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script>
	var sel = document.getElementById("select1");
	sel.addEventListener("change", loadProducts);

window.addEventListener("load",LoadCategories);

//網頁載入時，將產品分類的資料，放進html select標籤中
function LoadCategories(){
	var xhrCategory = new XMLHttpRequest();
	if (xhrCategory != null) {
		xhrCategory.addEventListener("readystatechange", function(){
			if (xhrCategory.readyState == 4) {
                if (xhrCategory.status == 200) {
                	
                	//收到的資料是JSON字串
                    var datas = xhrCategory.responseText;
                	//console.log(datas);
                	//使用前要先轉型成JSON物件，怎麼做?
                    var categories = JSON.parse(datas);  
                   // console.log(categories);
                	                   
               	  //讀出JSON中的資料
               	  //將資料顯示在html的select標籤中
               	  //用for迴圈讀出JSON中的資料      
               	  for(var i=0;i<categories.length;i++){
               		var opt = new Option(categories[i].CategoryName, categories[i].CategoryID);
               		sel.options.add(opt);
               	  }
                  //再將讀出的資料顯示在html的select標籤中
               	  //參考語法如下
               	  //var opt = new Option("text", "value");
               	  //select1.options.add(opt);
                 
             

                }
                else {
                    alert(xhrCategory.status + ":" + xhrCategory.statusText);
                }
            }
        });
		xhrCategory.open("get", "Categories"); 
		xhrCategory.send();

    }
}

//html select標籤選到不同項目時，會引發change事件
//change事件發生時，執行LoadProducts()函式
function loadProducts() {		
    var xhr = new XMLHttpRequest(),
        id = 0;    
    
	
	if (xhr != null){
		xhr.addEventListener("readystatechange",function(){
			if(xhr.readyState == 4){
				if(xhr.status == 200){			
		            var datas = xhr.responseText;
		            alert(datas);
					//還是要轉型成JSON物件
					var products = JSON.parse(datas);
					alert(products);
					var myBody = document.querySelector(".table>tbody");
					//先刪除表格中的內容
					while(myBody.hasChildNodes()){
						myBody.removeChild(myBody.lastChild);
					}
					
					 //讀出JSON中的資料
	               	  //將資料顯示在html的select標籤中
	               	  
	               	 for(var i=0;i<products.length;i++){
	               		 
	               	  	  var cell1 = document.createElement("td");
	 					  var txt1 = document.createTextNode(products[i].ProductID);
	 					  cell1.appendChild(txt1);
	 					  
	 					  var cell2 = document.createElement("td");
	 					  var txt2 = document.createTextNode(products[i].ProductName);
	 					  cell2.appendChild(txt2);
	 					  
	 					  var cell3 = document.createElement("td");
	 					  var txt3 = document.createTextNode(products[i].UnitPrice);
	 					  cell3.appendChild(txt3);
	 					  
	 					  var cell4 = document.createElement("td");
	 					  var txt4 = document.createTextNode(products[i].UnitsInStock);
	 					  cell4.appendChild(txt4);
	 					  
	 					  var row = document.createElement("tr");
	 					  row.appendChild(cell1);
	 					  row.appendChild(cell2);
	 					  row.appendChild(cell3);
	 					  row.appendChild(cell4);
	 					  
	 					 myBody.appendChild(row);
	 					  
	               	 }
	               	  //用for迴圈讀出JSON中的資料               	  
	                  //再將讀出的資料顯示在html的table標籤中
	               	  //參考語法如下
	               	  //建立<td>iPhone</td>
	               	  //var cell1 = document.createElement("td");
 					  //var txt1 = document.createTextNode("iPhone");
 					  //cell1.appendChild(txt1);
 					  //將<td>加到<tr>之下
 					  //var row = document.createElement("tr");
 					  //row.appendChild(cell1);
 					  //將<tr>加到<tbody>之下
 					  
 					
 					
 					
					
				}else{
					alert(xhr.status + ":" + xhr.statusText);
				}
			}	
			
		});
		
		//讀取html select標籤中，目前被選取項目的value(CategoryID)，語法參考如下
	    //select.options[select.selectedIndex].value
	    id = sel.options[sel.selectedIndex].value;
	
		//使用get的方式，將資料id傳到Server端Products.java的程式
		
        xhr.open('get','Products?categoryID='+id,true);
		xhr.send();	
	}else{
		alert("您的瀏覽器不支援Ajax功能!!");
	}	
			

}

	</script>

</body>

</html>